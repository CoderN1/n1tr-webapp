<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>N1 Panel</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0f0f;
      --surface: #1a1a1a;
      --surface2: #222222;
      --border: #2a2a2a;
      --accent: #6c5ce7;
      --accent-light: #a29bfe;
      --accent-glow: rgba(108,92,231,0.15);
      --green: #00b894;
      --red: #ff6b6b;
      --orange: #fdcb6e;
      --text: #e0e0e0;
      --text2: #999;
      --text3: #666;
      --radius: 12px;
      --radius-sm: 8px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15,15,15,0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-back {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text);
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .header-back:active { transform: scale(0.9); background: var(--surface2); }
    .header-back.visible { display: flex; }

    .header-title {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-light), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-subtitle {
      font-size: 11px;
      color: var(--text3);
      margin-left: auto;
    }

    /* Pages */
    .page { display: none; padding: 16px; padding-bottom: 40px; }
    .page.active { display: block; animation: fadeIn 0.25s ease; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* Accordion */
    .accordion { display: flex; flex-direction: column; gap: 8px; }

    .accordion-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      transition: all 0.2s;
    }

    .accordion-item.open { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent-glow), 0 4px 24px rgba(0,0,0,0.3); }

    .accordion-header {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      cursor: pointer;
      gap: 12px;
      user-select: none;
      transition: background 0.15s;
    }

    .accordion-header:active { background: var(--surface2); }

    .accordion-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .accordion-info { flex: 1; min-width: 0; }

    .accordion-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
    }

    .accordion-count {
      font-size: 12px;
      color: var(--text3);
      margin-top: 2px;
    }

    .accordion-arrow {
      font-size: 12px;
      color: var(--text3);
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }

    .accordion-item.open .accordion-arrow { transform: rotate(180deg); }

    .accordion-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s ease;
    }

    .accordion-body-inner {
      padding: 0 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .query-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 11px 14px;
      background: var(--surface2);
      border: 1px solid transparent;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s;
      color: var(--text);
      font-family: inherit;
      font-size: 13px;
      font-weight: 500;
      text-align: left;
      width: 100%;
    }

    .query-btn:active { transform: scale(0.98); background: var(--border); }
    .query-btn .q-icon { font-size: 16px; flex-shrink: 0; }
    .query-btn .q-label { flex: 1; }
    .query-btn .q-arrow { color: var(--text3); font-size: 11px; }

    /* Category Colors */
    .cat-mernis .accordion-icon { background: rgba(108,92,231,0.15); }
    .cat-telefon .accordion-icon { background: rgba(0,184,148,0.15); }
    .cat-ekstra .accordion-icon { background: rgba(253,203,110,0.15); }
    .cat-kontrol .accordion-icon { background: rgba(255,107,107,0.15); }
    .cat-tapu .accordion-icon { background: rgba(0,206,209,0.15); }
    .cat-diger .accordion-icon { background: rgba(162,155,254,0.15); }
    .cat-admin .accordion-icon { background: rgba(255,107,107,0.15); }

    /* Form Page */
    .form-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
    }

    .form-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 4px;
    }

    .form-desc {
      font-size: 12px;
      color: var(--text3);
      margin-bottom: 20px;
    }

    .form-group { margin-bottom: 16px; }

    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text2);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-family: inherit;
      font-size: 15px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-input::placeholder { color: var(--text3); }
    .form-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); }

    .form-hint {
      font-size: 11px;
      color: var(--text3);
      margin-top: 4px;
    }

    .form-submit {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-family: inherit;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }

    .form-submit:active { transform: scale(0.98); opacity: 0.9; }
    .form-submit:disabled { opacity: 0.5; cursor: not-allowed; }

    .form-optional {
      font-size: 10px;
      color: var(--text3);
      font-weight: 400;
      text-transform: none;
      letter-spacing: 0;
    }

    /* Result Page */
    .result-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .result-title {
      font-size: 16px;
      font-weight: 700;
    }

    .result-count {
      font-size: 12px;
      color: var(--accent-light);
      background: var(--accent-glow);
      padding: 4px 10px;
      border-radius: 20px;
    }

    .result-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 10px;
      overflow: hidden;
    }

    .result-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--surface2);
      border-bottom: 1px solid var(--border);
    }

    .result-card-num {
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-light);
    }

    .result-copy-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 5px 10px;
      background: var(--accent-glow);
      border: 1px solid rgba(108,92,231,0.3);
      border-radius: 6px;
      color: var(--accent-light);
      font-family: inherit;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }

    .result-copy-btn:active { transform: scale(0.95); }
    .result-copy-btn.copied { background: rgba(0,184,148,0.15); border-color: rgba(0,184,148,0.3); color: var(--green); }

    .result-rows { padding: 8px 0; }

    .result-row {
      display: flex;
      padding: 6px 16px;
      font-size: 13px;
      line-height: 1.5;
      transition: background 0.1s;
    }

    .result-row:active { background: var(--surface2); }

    .result-row-label {
      color: var(--text3);
      min-width: 110px;
      flex-shrink: 0;
      font-size: 12px;
    }

    .result-row-value {
      color: var(--text);
      font-weight: 500;
      word-break: break-all;
    }

    .result-row-value.empty { color: var(--text3); font-style: italic; font-weight: 400; }

    .result-copy-all {
      width: 100%;
      padding: 13px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--accent-light);
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      margin-top: 6px;
    }

    .result-copy-all:active { transform: scale(0.98); background: var(--surface2); }

    .no-result {
      text-align: center;
      padding: 40px 20px;
      color: var(--text3);
    }

    .no-result-icon { font-size: 48px; margin-bottom: 12px; }
    .no-result-text { font-size: 15px; font-weight: 600; margin-bottom: 4px; color: var(--text2); }
    .no-result-hint { font-size: 13px; }

    /* Loading */
    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15,15,15,0.9);
      backdrop-filter: blur(8px);
      z-index: 200;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 16px;
    }

    .loading-overlay.active { display: flex; }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-text { font-size: 14px; color: var(--text2); }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 20px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      z-index: 300;
      transition: transform 0.3s ease;
      white-space: nowrap;
    }

    .toast.show { transform: translateX(-50%) translateY(0); }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-back" id="backBtn" onclick="goBack()">&#8249;</div>
    <div class="header-title" id="headerTitle">N1 Panel</div>
    <div class="header-subtitle" id="headerSub">v2.0</div>
  </div>

  <!-- HOME PAGE -->
  <div class="page active" id="homePage">
    <div class="accordion" id="accordionContainer"></div>
  </div>

  <!-- FORM PAGE -->
  <div class="page" id="formPage">
    <div class="form-card" id="formCard"></div>
  </div>

  <!-- RESULT PAGE -->
  <div class="page" id="resultPage">
    <div id="resultContainer"></div>
  </div>

  <!-- LOADING -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">SorgulanÄ±yor...</div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

<script>
const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
if (tg) { tg.expand(); tg.ready(); }

const userId = tg ? (tg.initDataUnsafe?.user?.id || 0) : 0;
const ADMIN_ID = 7424617978;
const isAdmin = userId === ADMIN_ID;

// â”€â”€â”€ Query Definitions â”€â”€â”€
const categories = [
  {
    id: 'mernis', name: 'Mernis', icon: 'ðŸ”', css: 'cat-mernis',
    queries: [
      { type:'tckn', name:'TC Kimlik Sorgu', icon:'ðŸªª', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'tc_pro', name:'TC Pro Sorgu', icon:'ðŸªª', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'ad_soyad', name:'Ad Soyad Sorgu', icon:'ðŸ‘¤', fields:[{key:'firstName',label:'Ad',placeholder:'Ahmet'},{key:'lastName',label:'Soyad',placeholder:'YÄ±lmaz'}] },
      { type:'ad_soyad_pro', name:'Ad Soyad Pro', icon:'ðŸ‘¤', fields:[{key:'firstName',label:'Ad',placeholder:'Ahmet'},{key:'lastName',label:'Soyad',placeholder:'YÄ±lmaz'},{key:'city',label:'Ä°l',placeholder:'Ä°stanbul'},{key:'district',label:'Ä°lÃ§e',placeholder:'KadÄ±kÃ¶y',optional:true}] },
      { type:'aile', name:'Aile Sorgu', icon:'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'aile_pro', name:'Aile Pro Sorgu', icon:'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'sulale', name:'SÃ¼lale Sorgu', icon:'ðŸŒ³', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'sulale_pro', name:'SÃ¼lale Pro', icon:'ðŸŒ³', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'hikaye', name:'Hikaye', icon:'ðŸ“–', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] }
    ]
  },
  {
    id: 'telefon', name: 'Telefon', icon: 'ðŸ“±', css: 'cat-telefon',
    queries: [
      { type:'tcgsm', name:'TC â†’ GSM', icon:'ðŸ“²', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'gsmtc', name:'GSM â†’ TC', icon:'ðŸ“²', fields:[{key:'gsm',label:'Telefon No',placeholder:'05XX XXX XXXX'}] },
      { type:'operator', name:'OperatÃ¶r Sorgu', icon:'ðŸ“¡', fields:[{key:'gsm',label:'Telefon No',placeholder:'05XX XXX XXXX'}] }
    ]
  },
  {
    id: 'ekstra', name: 'Ekstra', icon: 'âš¡', css: 'cat-ekstra',
    queries: [
      { type:'adres', name:'Adres Sorgu', icon:'ðŸ“', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'adres_2015', name:'Adres 2015', icon:'ðŸ“', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'is_yeri', name:'Ä°ÅŸ Yeri Sorgu', icon:'ðŸ¢', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'okul_no', name:'Okul No Sorgu', icon:'ðŸŽ“', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'vesika', name:'Vesika Sorgu', icon:'ðŸ“¸', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'yabanci', name:'YabancÄ± Sorgu', icon:'ðŸŒ', fields:[{key:'id',label:'Pasaport/Kimlik No',placeholder:'Numara girin'}] },
      { type:'akparti', name:'AK Parti Sorgu', icon:'ðŸ›ï¸', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] }
    ]
  },
  {
    id: 'kontrol', name: 'Kontrol', icon: 'ðŸ›¡ï¸', css: 'cat-kontrol',
    queries: [
      { type:'dns', name:'DNS Sorgu', icon:'ðŸŒ', fields:[{key:'domain',label:'Domain',placeholder:'example.com'}] },
      { type:'bin', name:'BIN Sorgu', icon:'ðŸ’³', fields:[{key:'bin',label:'BIN (6 hane)',placeholder:'123456',maxlength:6}] },
      { type:'ip_checker', name:'IP Sorgu', icon:'ðŸŒ', fields:[{key:'ip',label:'IP Adresi',placeholder:'1.2.3.4'}] },
      { type:'mail_checker', name:'Mail Sorgu', icon:'ðŸ“§', fields:[{key:'email',label:'E-Posta',placeholder:'ornek@mail.com'}] },
      { type:'cc_checker', name:'CC Check', icon:'ðŸ’³', fields:[{key:'cc',label:'Kart Bilgisi',placeholder:'Kart bilgisi girin'}] },
      { type:'dc', name:'Discord Sorgu', icon:'ðŸŽ®', fields:[{key:'token',label:'Discord Token',placeholder:'Token girin'}] }
    ]
  },
  {
    id: 'tapu', name: 'Tapu', icon: 'ðŸ ', css: 'cat-tapu',
    queries: [
      { type:'tapu', name:'Tapu Sorgu', icon:'ðŸ ', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'istanbul_tapu', name:'Ä°stanbul Tapu', icon:'ðŸ ', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] },
      { type:'kocaeli_tapu', name:'Kocaeli Tapu', icon:'ðŸ ', fields:[{key:'tc',label:'TC Kimlik No',placeholder:'11 haneli TC',maxlength:11}] }
    ]
  },
  {
    id: 'diger', name: 'DiÄŸer', icon: 'ðŸ“¦', css: 'cat-diger',
    queries: [
      { type:'gpt', name:'GPT Soru', icon:'ðŸ¤–', fields:[{key:'question',label:'Soru',placeholder:'Sorunuzu yazÄ±n'}] },
      { type:'sifre_olusturucu', name:'Åžifre OluÅŸturucu', icon:'ðŸ”', fields:[{key:'length',label:'Uzunluk',placeholder:'16'}] },
      { type:'web_kazima', name:'Web KazÄ±ma', icon:'ðŸ•·ï¸', fields:[{key:'url',label:'URL',placeholder:'https://example.com'}] },
      { type:'encode', name:'Encode', icon:'ðŸ”’', fields:[{key:'text',label:'Metin',placeholder:'Encode edilecek metin'}] },
      { type:'decode', name:'Decode', icon:'ðŸ”“', fields:[{key:'text',label:'Metin',placeholder:'Decode edilecek metin'}] },
      { type:'log_finder', name:'Log Finder', icon:'ðŸ“‚', fields:[{key:'query',label:'Arama',placeholder:'Aranacak terim'}] },
      { type:'screenshot', name:'Screenshot', icon:'ðŸ“¸', fields:[{key:'url',label:'URL',placeholder:'https://example.com'}] },
      { type:'craftrise', name:'Craftrise', icon:'ðŸŽ®', fields:[{key:'username',label:'KullanÄ±cÄ± AdÄ±',placeholder:'KullanÄ±cÄ± adÄ±'}] },
      { type:'facebook', name:'Facebook', icon:'ðŸ“˜', fields:[{key:'link',label:'Profil Linki',placeholder:'Profil URL girin'}] },
      { type:'qr', name:'QR OluÅŸturucu', icon:'ðŸ“±', fields:[{key:'text',label:'Metin/URL',placeholder:'QR iÃ§eriÄŸi'}] }
    ]
  }
];

const adminCategory = {
  id:'admin', name:'Admin Panel', icon:'âš™ï¸', css:'cat-admin',
  queries: [
    { type:'admin_announcement', name:'Duyuru GÃ¶nder', icon:'ðŸ“¢', fields:[{key:'message',label:'Duyuru Metni',placeholder:'Duyuru yazÄ±n'}] },
    { type:'admin_total_users', name:'Toplam KullanÄ±cÄ±', icon:'ðŸ“Š', fields:[] },
    { type:'admin_user_list', name:'KullanÄ±cÄ± Listesi', icon:'ðŸ“‹', fields:[] },
    { type:'admin_ban_user', name:'KullanÄ±cÄ± Banla', icon:'ðŸš«', fields:[{key:'userId',label:'KullanÄ±cÄ± ID',placeholder:'Telegram ID'}] },
    { type:'admin_unban_user', name:'Ban KaldÄ±r', icon:'âœ…', fields:[{key:'userId',label:'KullanÄ±cÄ± ID',placeholder:'Telegram ID'}] },
    { type:'admin_banlist', name:'Ban Listesi', icon:'ðŸ“‹', fields:[] },
    { type:'admin_get_logs', name:'LoglarÄ± Getir', icon:'ðŸ“„', fields:[] },
    { type:'admin_restart_bot', name:'Botu Yeniden BaÅŸlat', icon:'ðŸ”„', fields:[] },
    { type:'admin_destroy_bot', name:'Botu Durdur', icon:'ðŸ’€', fields:[] }
  ]
};

// â”€â”€â”€ Build Accordion â”€â”€â”€
let currentQuery = null;
let pageHistory = ['home'];

function buildAccordion() {
  const container = document.getElementById('accordionContainer');
  const cats = isAdmin ? [...categories, adminCategory] : [...categories];

  container.innerHTML = cats.map(cat => `
    <div class="accordion-item ${cat.css}" data-cat="${cat.id}">
      <div class="accordion-header" onclick="toggleAccordion('${cat.id}')">
        <div class="accordion-icon">${cat.icon}</div>
        <div class="accordion-info">
          <div class="accordion-name">${cat.name}</div>
          <div class="accordion-count">${cat.queries.length} sorgu</div>
        </div>
        <div class="accordion-arrow">â–¼</div>
      </div>
      <div class="accordion-body" id="body-${cat.id}">
        <div class="accordion-body-inner">
          ${cat.queries.map(q => `
            <button class="query-btn" onclick="openForm('${cat.id}','${q.type}')">
              <span class="q-icon">${q.icon}</span>
              <span class="q-label">${q.name}</span>
              <span class="q-arrow">â€º</span>
            </button>
          `).join('')}
        </div>
      </div>
    </div>
  `).join('');
}

function toggleAccordion(catId) {
  const item = document.querySelector(`[data-cat="${catId}"]`);
  const body = document.getElementById('body-' + catId);
  const isOpen = item.classList.contains('open');

  // Close all
  document.querySelectorAll('.accordion-item').forEach(el => {
    el.classList.remove('open');
    el.querySelector('.accordion-body').style.maxHeight = '0';
  });

  // Open clicked if was closed
  if (!isOpen) {
    item.classList.add('open');
    body.style.maxHeight = body.scrollHeight + 'px';
  }
}

// â”€â”€â”€ Form Page â”€â”€â”€
function openForm(catId, queryType) {
  const allCats = isAdmin ? [...categories, adminCategory] : [...categories];
  const cat = allCats.find(c => c.id === catId);
  const query = cat.queries.find(q => q.type === queryType);
  currentQuery = query;

  const formCard = document.getElementById('formCard');

  if (query.fields.length === 0) {
    // No fields, send immediately
    sendData(query.type, {});
    return;
  }

  formCard.innerHTML = `
    <div class="form-title">${query.icon} ${query.name}</div>
    <div class="form-desc">Bilgileri doldurup sorgulayÄ±n</div>
    ${query.fields.map((f, i) => `
      <div class="form-group">
        <label class="form-label">${f.label} ${f.optional ? '<span class="form-optional">(Opsiyonel)</span>' : ''}</label>
        <input class="form-input" id="field-${i}" type="text" placeholder="${f.placeholder}" ${f.maxlength ? `maxlength="${f.maxlength}"` : ''} autocomplete="off">
        ${f.optional ? '<div class="form-hint">BoÅŸ bÄ±rakabilirsiniz</div>' : ''}
      </div>
    `).join('')}
    <button class="form-submit" onclick="submitForm()">Sorgula</button>
  `;

  showPage('form');
  document.getElementById('headerTitle').textContent = query.name;

  // Focus first input
  setTimeout(() => { const inp = document.getElementById('field-0'); if (inp) inp.focus(); }, 300);
}

function submitForm() {
  if (!currentQuery) return;

  const data = {};
  let valid = true;

  currentQuery.fields.forEach((f, i) => {
    const input = document.getElementById('field-' + i);
    const val = input.value.trim();
    if (!f.optional && !val) {
      input.style.borderColor = 'var(--red)';
      valid = false;
    } else {
      input.style.borderColor = '';
    }
    data[f.key] = val || null;
  });

  if (!valid) { showToast('LÃ¼tfen tÃ¼m alanlarÄ± doldurun'); return; }

  sendData(currentQuery.type, data);
}

function sendData(type, data) {
  if (tg) {
    tg.sendData(JSON.stringify({ type, data }));
    showLoading(true);
    // WebApp will close after sendData, but show loading just in case
    setTimeout(() => { showLoading(false); showToast('Sorgu gÃ¶nderildi'); }, 2000);
  } else {
    // Browser test mode
    showToast('Test: ' + type + ' â†’ ' + JSON.stringify(data));
  }
}

// â”€â”€â”€ Navigation â”€â”€â”€
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

  if (page === 'home') {
    document.getElementById('homePage').classList.add('active');
    document.getElementById('backBtn').classList.remove('visible');
    document.getElementById('headerTitle').textContent = 'N1 Panel';
    pageHistory = ['home'];
  } else if (page === 'form') {
    document.getElementById('formPage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    pageHistory.push('form');
  } else if (page === 'result') {
    document.getElementById('resultPage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    pageHistory.push('result');
  }
}

function goBack() {
  pageHistory.pop();
  const prev = pageHistory[pageHistory.length - 1] || 'home';
  showPage(prev);
}

// â”€â”€â”€ Utilities â”€â”€â”€
function showLoading(show) {
  document.getElementById('loadingOverlay').classList.toggle('active', show);
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

function copyText(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    if (btn) { btn.classList.add('copied'); btn.textContent = 'âœ“ KopyalandÄ±'; setTimeout(() => { btn.classList.remove('copied'); btn.textContent = 'ðŸ“‹ Kopyala'; }, 1500); }
    else showToast('KopyalandÄ±');
  }).catch(() => showToast('KopyalanamadÄ±'));
}

// â”€â”€â”€ Init â”€â”€â”€
buildAccordion();
</script>
</body>
</html>
