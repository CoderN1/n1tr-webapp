<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>N1 T√úRKƒ∞YE</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #050a0e;
      --surface: #0a1117;
      --surface2: #0f1923;
      --surface3: #142230;
      --border: #1a2d3d;
      --green: #00ff95;
      --green2: #00cc77;
      --green-dim: #00ff9520;
      --cyan: #00e5ff;
      --cyan-dim: #00e5ff15;
      --red: #ff3355;
      --red-dim: #ff335515;
      --yellow: #ffcc00;
      --yellow-dim: #ffcc0015;
      --purple: #bf5fff;
      --purple-dim: #bf5fff15;
      --text: #c5d0da;
      --text2: #6a7a8a;
      --text3: #3a4a5a;
      --radius: 10px;
      --radius-sm: 6px;
      --font: 'JetBrains Mono', monospace;
    }
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body { font-family:var(--font); background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }
    body::before { content:''; position:fixed; inset:0; background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,149,0.012) 2px,rgba(0,255,149,0.012) 4px); pointer-events:none; z-index:9999; }
    #matrixCanvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; opacity:0.06; pointer-events:none; }

    .header { position:sticky; top:0; z-index:100; background:rgba(5,10,14,0.92); backdrop-filter:blur(16px); border-bottom:1px solid var(--border); padding:0 16px; height:56px; display:flex; align-items:center; gap:10px; }
    .header::after { content:''; position:absolute; bottom:-1px; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,var(--green),transparent); opacity:0.3; }
    .header-back { width:32px; height:32px; border-radius:6px; background:var(--surface2); border:1px solid var(--border); color:var(--green); display:none; align-items:center; justify-content:center; cursor:pointer; font-size:16px; transition:all 0.15s; flex-shrink:0; }
    .header-back:active { transform:scale(0.9); }
    .header-back.visible { display:flex; }
    .terminal-dots { display:flex; gap:5px; margin-right:4px; }
    .terminal-dots span { width:8px; height:8px; border-radius:50%; }
    .terminal-dots span:nth-child(1) { background:#ff5f57; }
    .terminal-dots span:nth-child(2) { background:#febc2e; }
    .terminal-dots span:nth-child(3) { background:#28c840; }
    .header-title { font-size:14px; font-weight:700; color:var(--green); text-shadow:0 0 10px rgba(0,255,149,0.3); letter-spacing:1px; }
    .blink { animation:blink 1s step-end infinite; }
    @keyframes blink { 50% { opacity:0; } }
    .header-status { margin-left:auto; font-size:10px; color:var(--text3); display:flex; align-items:center; gap:4px; }
    .header-status .dot { width:6px; height:6px; border-radius:50%; background:var(--green); box-shadow:0 0 6px var(--green); animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

    .page { display:none; padding:12px; padding-bottom:40px; position:relative; z-index:1; }
    .page.active { display:block; animation:pageIn 0.25s ease; }
    @keyframes pageIn { from{opacity:0;transform:translateY(6px);} to{opacity:1;transform:translateY(0);} }

    .boot-text { font-size:10px; color:var(--text3); margin-bottom:14px; padding:8px 10px; background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-sm); line-height:1.7; }
    .boot-text .ok { color:var(--green); }

    .accordion { display:flex; flex-direction:column; gap:6px; }
    .accordion-item { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; transition:all 0.25s; }
    .accordion-item.open { border-color:var(--green); box-shadow:0 0 15px rgba(0,255,149,0.07),inset 0 0 15px rgba(0,255,149,0.03); }
    .accordion-header { display:flex; align-items:center; padding:12px 14px; cursor:pointer; gap:10px; user-select:none; }
    .accordion-header:active { background:var(--surface2); }
    .accordion-icon { width:38px; height:38px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
    .accordion-info { flex:1; }
    .accordion-name { font-size:13px; font-weight:600; }
    .accordion-count { font-size:10px; color:var(--text3); margin-top:1px; }
    .accordion-arrow { color:var(--text3); transition:transform 0.3s,color 0.3s; font-size:10px; }
    .accordion-item.open .accordion-arrow { transform:rotate(180deg); color:var(--green); }
    .accordion-body { max-height:0; overflow:hidden; transition:max-height 0.35s ease; }
    .accordion-body-inner { padding:2px 10px 10px; display:flex; flex-direction:column; gap:3px; }
    .query-btn { display:flex; align-items:center; gap:8px; padding:10px 12px; background:var(--surface2); border:1px solid var(--border); border-radius:var(--radius-sm); cursor:pointer; transition:all 0.15s; color:var(--text); font-family:var(--font); font-size:12px; font-weight:500; text-align:left; width:100%; }
    .query-btn:active { transform:scale(0.98); border-color:var(--green); }
    .query-btn .q-icon { font-size:14px; }
    .query-btn .q-label { flex:1; }
    .query-btn .q-arrow { color:var(--green); font-size:12px; opacity:0.5; }

    .cat-mernis .accordion-icon { color:var(--green); background:var(--green-dim); }
    .cat-mernis.open { border-color:var(--green); }
    .cat-telefon .accordion-icon { color:var(--cyan); background:var(--cyan-dim); }
    .cat-telefon.open { border-color:var(--cyan); box-shadow:0 0 15px rgba(0,229,255,0.07); }
    .cat-ekstra .accordion-icon { color:var(--yellow); background:var(--yellow-dim); }
    .cat-ekstra.open { border-color:var(--yellow); box-shadow:0 0 15px rgba(255,204,0,0.07); }
    .cat-kontrol .accordion-icon { color:var(--red); background:var(--red-dim); }
    .cat-kontrol.open { border-color:var(--red); box-shadow:0 0 15px rgba(255,51,85,0.07); }
    .cat-tapu .accordion-icon { color:var(--cyan); background:var(--cyan-dim); }
    .cat-tapu.open { border-color:var(--cyan); }
    .cat-diger .accordion-icon { color:var(--purple); background:var(--purple-dim); }
    .cat-diger.open { border-color:var(--purple); box-shadow:0 0 15px rgba(191,95,255,0.07); }
    .cat-admin .accordion-icon { color:var(--red); background:var(--red-dim); }
    .cat-admin.open { border-color:var(--red); }

    .form-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); padding:18px; position:relative; }
    .form-card::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--green),var(--cyan),var(--green)); border-radius:var(--radius) var(--radius) 0 0; }
    .form-title { font-size:15px; font-weight:700; color:var(--green); margin-bottom:2px; text-shadow:0 0 8px rgba(0,255,149,0.2); }
    .form-desc { font-size:10px; color:var(--text3); margin-bottom:18px; }
    .form-group { margin-bottom:14px; }
    .form-label { display:flex; align-items:center; gap:6px; font-size:10px; font-weight:600; color:var(--text2); margin-bottom:6px; text-transform:uppercase; letter-spacing:1px; }
    .form-label::before { content:'>'; color:var(--green); font-weight:700; }
    .form-input { width:100%; padding:12px 14px; background:var(--bg); border:1px solid var(--border); border-radius:var(--radius-sm); color:var(--green); font-family:var(--font); font-size:14px; font-weight:500; outline:none; transition:all 0.2s; caret-color:var(--green); }
    .form-input::placeholder { color:var(--text3); font-weight:400; }
    .form-input:focus { border-color:var(--green); box-shadow:0 0 0 3px rgba(0,255,149,0.1); }
    .form-hint { font-size:10px; color:var(--text3); margin-top:4px; }
    .form-optional { font-size:9px; color:var(--text3); font-weight:400; text-transform:none; letter-spacing:0; }
    .form-submit { width:100%; padding:13px; background:linear-gradient(135deg,rgba(0,255,149,0.15),rgba(0,229,255,0.1)); border:1px solid var(--green); border-radius:var(--radius-sm); color:var(--green); font-family:var(--font); font-size:13px; font-weight:700; cursor:pointer; transition:all 0.2s; margin-top:8px; letter-spacing:1px; text-transform:uppercase; text-shadow:0 0 8px rgba(0,255,149,0.3); }
    .form-submit:active { transform:scale(0.98); }
    .form-submit:disabled { opacity:0.3; cursor:not-allowed; }

    /* Results */
    .result-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; padding-bottom:10px; border-bottom:1px solid var(--border); }
    .result-title { font-size:13px; font-weight:700; color:var(--green); text-shadow:0 0 8px rgba(0,255,149,0.2); }
    .result-count { font-size:10px; color:var(--green); background:var(--green-dim); padding:3px 8px; border-radius:4px; border:1px solid rgba(0,255,149,0.2); font-weight:600; }
    .result-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); margin-bottom:8px; overflow:hidden; position:relative; }
    .result-card::before { content:''; position:absolute; top:0; left:0; width:2px; height:100%; background:var(--green); opacity:0.5; }
    .result-card-header { display:flex; align-items:center; justify-content:space-between; padding:10px 14px; background:var(--surface2); border-bottom:1px solid var(--border); }
    .result-card-num { font-size:10px; font-weight:700; color:var(--cyan); letter-spacing:1px; }
    .result-copy-btn { padding:4px 8px; background:transparent; border:1px solid var(--border); border-radius:4px; color:var(--text2); font-family:var(--font); font-size:10px; cursor:pointer; transition:all 0.15s; }
    .result-copy-btn:active { transform:scale(0.95); }
    .result-copy-btn.copied { border-color:var(--green); color:var(--green); }
    .result-rows { padding:6px 0; }
    .result-row { display:flex; padding:5px 14px; font-size:11px; line-height:1.6; gap:8px; }
    .result-row:nth-child(odd) { background:rgba(0,255,149,0.015); }
    .result-row-label { color:var(--text3); min-width:100px; flex-shrink:0; font-size:10px; font-weight:600; letter-spacing:0.3px; }
    .result-row-value { color:var(--green); font-weight:500; word-break:break-all; }
    .result-row-value.empty { color:var(--text3); font-style:italic; font-weight:400; }
    .result-copy-all { width:100%; padding:12px; background:var(--surface); border:1px solid var(--border); border-radius:var(--radius-sm); color:var(--cyan); font-family:var(--font); font-size:12px; font-weight:600; cursor:pointer; transition:all 0.15s; margin-top:6px; letter-spacing:0.5px; }
    .result-copy-all:active { transform:scale(0.98); border-color:var(--cyan); }

    .error-box { text-align:center; padding:30px 20px; }
    .error-icon { font-size:36px; margin-bottom:8px; }
    .error-text { font-size:14px; font-weight:600; color:var(--red); margin-bottom:4px; }
    .error-hint { font-size:11px; color:var(--text3); }
    .error-retry { margin-top:14px; padding:10px 24px; background:transparent; border:1px solid var(--red); border-radius:var(--radius-sm); color:var(--red); font-family:var(--font); font-size:12px; font-weight:600; cursor:pointer; }

    .loading-overlay { display:none; position:fixed; inset:0; background:rgba(5,10,14,0.92); backdrop-filter:blur(8px); z-index:200; align-items:center; justify-content:center; flex-direction:column; gap:14px; }
    .loading-overlay.active { display:flex; }
    .cyber-loader { width:44px; height:44px; border:2px solid var(--border); border-top-color:var(--green); border-right-color:var(--cyan); border-radius:50%; animation:spin 0.7s linear infinite; box-shadow:0 0 15px rgba(0,255,149,0.15); }
    @keyframes spin { to{transform:rotate(360deg);} }
    .loading-text { font-size:12px; color:var(--green); letter-spacing:2px; text-transform:uppercase; animation:loadPulse 1.5s ease infinite; }
    @keyframes loadPulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

    .toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%) translateY(80px); background:var(--surface2); border:1px solid var(--green); color:var(--green); padding:8px 18px; border-radius:6px; font-size:11px; font-family:var(--font); font-weight:600; z-index:300; transition:transform 0.3s ease; white-space:nowrap; box-shadow:0 0 20px rgba(0,255,149,0.1); }
    .toast.show { transform:translateX(-50%) translateY(0); }
    .toast.error { border-color:var(--red); color:var(--red); }

    ::-webkit-scrollbar { width:3px; }
    ::-webkit-scrollbar-track { background:transparent; }
    ::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
  </style>
</head>
<body>
<canvas id="matrixCanvas"></canvas>

<div class="header">
  <div class="header-back" id="backBtn" onclick="goBack()">‚Äπ</div>
  <div class="terminal-dots"><span></span><span></span><span></span></div>
  <div class="header-title" id="headerTitle">N1 T√úRKƒ∞YE:~$ <span class="blink">_</span></div>
  <div class="header-status"><div class="dot"></div> online</div>
</div>

<div class="page active" id="homePage">
  <div class="boot-text" id="bootText"></div>
  <div class="accordion" id="accordionContainer"></div>
</div>

<div class="page" id="formPage">
  <div class="form-card" id="formCard"></div>
</div>

<div class="page" id="resultPage">
  <div id="resultContainer"></div>
</div>

<div class="loading-overlay" id="loadingOverlay">
  <div class="cyber-loader"></div>
  <div class="loading-text">Sorgulanƒ±yor...</div>
</div>

<div class="toast" id="toast"></div>

<script>
const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
if (tg) { tg.expand(); tg.ready(); }
const userId = tg ? (tg.initDataUnsafe?.user?.id || 0) : 0;
const ADMIN_ID = 7424617978;
const isAdmin = userId === ADMIN_ID;

// API base URL = same origin (served from Express)
const API = window.location.origin;

// Matrix Rain
(function(){
  const c=document.getElementById('matrixCanvas'),ctx=c.getContext('2d');
  let w,h,cols,drops;
  function resize(){w=c.width=innerWidth;h=c.height=innerHeight;cols=Math.floor(w/14);drops=Array(cols).fill(1);}
  resize(); window.addEventListener('resize',resize);
  const chars='„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ0123456789ABCDEF';
  function draw(){ctx.fillStyle='rgba(5,10,14,0.08)';ctx.fillRect(0,0,w,h);ctx.fillStyle='#00ff9515';ctx.font='12px monospace';for(let i=0;i<cols;i++){ctx.fillText(chars[Math.floor(Math.random()*chars.length)],i*14,drops[i]*14);if(drops[i]*14>h&&Math.random()>0.975)drops[i]=0;drops[i]++;}requestAnimationFrame(draw);}
  draw();
})();

// Boot
(function(){
  const el=document.getElementById('bootText');
  const lines=[['[SYS]','Initializing N1 T√úRKƒ∞YE...','ok'],['[NET]','Database nodes connected','ok'],['[SEC]','Encryption active (AES-256)','ok'],['[API]','Query modules loaded','ok'],['[RDY]',`${isAdmin?'Admin':'User'} session started ‚úì`,'ok']];
  el.innerHTML=lines.map((l,i)=>`<div style="opacity:0;animation:fadeIn 0.15s ${i*0.1}s forwards"><span style="color:var(--cyan)">${l[0]}</span> ${l[1]} <span class="ok">[OK]</span></div>`).join('');
})();

// Query Definitions
const categories = [
  { id:'mernis', name:'Mernis', icon:'‚üÅ', css:'cat-mernis', queries:[
    {type:'tckn',name:'TC Kimlik Sorgu',icon:'‚óà',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'tckn_pro',name:'TC Pro Sorgu',icon:'‚óà',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'ad_soyad',name:'Ad Soyad Sorgu',icon:'‚óâ',fields:[{key:'ad',label:'Ad',placeholder:'Ahmet'},{key:'soyad',label:'Soyad',placeholder:'Yƒ±lmaz'}]},
    {type:'ad_soyad_pro',name:'Ad Soyad Pro',icon:'‚óâ',fields:[{key:'ad',label:'Ad',placeholder:'Ahmet'},{key:'soyad',label:'Soyad',placeholder:'Yƒ±lmaz'},{key:'il',label:'ƒ∞l',placeholder:'ƒ∞stanbul'},{key:'ilce',label:'ƒ∞l√ße',placeholder:'Kadƒ±k√∂y',optional:true}]},
    {type:'aile',name:'Aile Sorgu',icon:'‚óé',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'ailepro',name:'Aile Pro Sorgu',icon:'‚óé',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'sulale',name:'S√ºlale Sorgu',icon:'‚óé',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'sulale_pro',name:'S√ºlale Pro',icon:'‚óé',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'hikaye',name:'Hikaye',icon:'‚óà',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]}
  ]},
  { id:'telefon', name:'Telefon', icon:'‚òé', css:'cat-telefon', queries:[
    {type:'tcgsm',name:'TC ‚Üí GSM',icon:'‚ñ∏',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'gsmtc',name:'GSM ‚Üí TC',icon:'‚ñ∏',fields:[{key:'telefon',label:'Telefon No',placeholder:'05XX XXX XXXX'}]},
    {type:'operator',name:'Operat√∂r Sorgu',icon:'‚ñ∏',fields:[{key:'telefon',label:'Telefon No',placeholder:'05XX XXX XXXX'}]}
  ]},
  { id:'ekstra', name:'Ekstra', icon:'‚ö°', css:'cat-ekstra', queries:[
    {type:'adres',name:'Adres Sorgu',icon:'‚ñπ',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'adres_2015',name:'Adres 2015',icon:'‚ñπ',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'is_yeri',name:'ƒ∞≈ü Yeri Sorgu',icon:'‚ñπ',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'okul_no',name:'Okul No Sorgu',icon:'‚ñπ',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'vesika',name:'Vesika Sorgu',icon:'‚ñπ',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'yabanci',name:'Yabancƒ± Sorgu',icon:'‚ñπ',fields:[{key:'kimlik',label:'Pasaport/Kimlik No',placeholder:'Numara girin'}]},
    {type:'akparti',name:'AK Parti Sorgu',icon:'‚ñπ',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]}
  ]},
  { id:'kontrol', name:'Kontrol', icon:'‚õ®', css:'cat-kontrol', queries:[
    {type:'dns',name:'DNS Sorgu',icon:'‚äï',fields:[{key:'domain',label:'Domain',placeholder:'example.com'}]},
    {type:'bin',name:'BIN Sorgu',icon:'‚äï',fields:[{key:'bin_no',label:'BIN (6 hane)',placeholder:'123456',maxlength:6}]},
    {type:'ip_checker',name:'IP Sorgu',icon:'‚äï',fields:[{key:'ip',label:'IP Adresi',placeholder:'1.2.3.4'}]},
    {type:'mail_checker',name:'Mail Sorgu',icon:'‚äï',fields:[{key:'email',label:'E-Posta',placeholder:'ornek@mail.com'}]},
    {type:'cc_checker',name:'CC Check',icon:'‚äï',fields:[{key:'cc',label:'Kart Bilgisi',placeholder:'Kart bilgisi girin'}]},
    {type:'dc',name:'Discord Sorgu',icon:'‚äï',fields:[{key:'token',label:'Discord Token',placeholder:'Token girin'}]}
  ]},
  { id:'tapu', name:'Tapu', icon:'‚åÇ', css:'cat-tapu', queries:[
    {type:'tapu',name:'Tapu Sorgu',icon:'‚ñ°',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'istanbul_tapu',name:'ƒ∞stanbul Tapu',icon:'‚ñ°',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]},
    {type:'kocaeli_tapu',name:'Kocaeli Tapu',icon:'‚ñ°',fields:[{key:'tc',label:'TC Kimlik No',placeholder:'xxxxxxxxxxx',maxlength:11}]}
  ]},
  { id:'diger', name:'Diƒüer', icon:'‚å¨', css:'cat-diger', queries:[
    {type:'gpt',name:'GPT Soru',icon:'‚óá',fields:[{key:'soru',label:'Soru',placeholder:'Sorunuzu yazƒ±n'}]},
    {type:'sifre_olusturucu',name:'≈ûifre Olu≈üturucu',icon:'‚óá',fields:[{key:'uzunluk',label:'Uzunluk',placeholder:'16'}]},
    {type:'web_kazima',name:'Web Kazƒ±ma',icon:'‚óá',fields:[{key:'url',label:'URL',placeholder:'https://example.com'}]},
    {type:'encode',name:'Encode',icon:'‚óá',fields:[{key:'metin',label:'Metin',placeholder:'Encode edilecek metin'}]},
    {type:'decode',name:'Decode',icon:'‚óá',fields:[{key:'metin',label:'Metin',placeholder:'Decode edilecek metin'}]},
    {type:'log',name:'Log Finder',icon:'‚óá',fields:[{key:'arama',label:'Arama',placeholder:'Aranacak terim'}]},
    {type:'screen',name:'Screenshot',icon:'‚óá',fields:[{key:'url',label:'URL',placeholder:'https://example.com'}]},
    {type:'craft',name:'Craftrise',icon:'‚óá',fields:[{key:'kullanici',label:'Kullanƒ±cƒ± Adƒ±',placeholder:'Kullanƒ±cƒ± adƒ±'}]},
    {type:'face',name:'Facebook',icon:'‚óá',fields:[{key:'link',label:'Profil Linki',placeholder:'Profil URL girin'}]},
    {type:'qr_gen',name:'QR Olu≈üturucu',icon:'‚óá',fields:[{key:'metin',label:'Metin/URL',placeholder:'QR i√ßeriƒüi'}]}
  ]}
];

const adminCategory = {
  id:'admin', name:'Admin Panel', icon:'‚ö†', css:'cat-admin', queries:[
    {type:'admin_announcement',name:'Duyuru G√∂nder',icon:'‚ñ∏',fields:[{key:'mesaj',label:'Duyuru Metni',placeholder:'Duyuru yazƒ±n'}]},
    {type:'admin_total_users',name:'Toplam Kullanƒ±cƒ±',icon:'‚ñ∏',fields:[]},
    {type:'admin_user_list',name:'Kullanƒ±cƒ± Listesi',icon:'‚ñ∏',fields:[]},
    {type:'admin_ban_user',name:'Kullanƒ±cƒ± Banla',icon:'‚ñ∏',fields:[{key:'hedef',label:'Kullanƒ±cƒ± ID',placeholder:'Telegram ID'}]},
    {type:'admin_unban_user',name:'Ban Kaldƒ±r',icon:'‚ñ∏',fields:[{key:'hedef',label:'Kullanƒ±cƒ± ID',placeholder:'Telegram ID'}]},
    {type:'admin_banlist',name:'Ban Listesi',icon:'‚ñ∏',fields:[]},
    {type:'admin_get_logs',name:'Loglarƒ± Getir',icon:'‚ñ∏',fields:[]},
    {type:'admin_restart_bot',name:'Botu Yeniden Ba≈ülat',icon:'‚ñ∏',fields:[]},
    {type:'admin_destroy_bot',name:'Botu Durdur',icon:'‚ñ∏',fields:[]}
  ]
};

let currentQuery = null;
let pageStack = ['home'];

function buildAccordion() {
  const c = document.getElementById('accordionContainer');
  const cats = isAdmin ? [...categories, adminCategory] : [...categories];
  c.innerHTML = cats.map(cat => `
    <div class="accordion-item ${cat.css}" data-cat="${cat.id}">
      <div class="accordion-header" onclick="toggleAccordion('${cat.id}')">
        <div class="accordion-icon">${cat.icon}</div>
        <div class="accordion-info">
          <div class="accordion-name">${cat.name}</div>
          <div class="accordion-count">${cat.queries.length} mod√ºl</div>
        </div>
        <div class="accordion-arrow">‚ñº</div>
      </div>
      <div class="accordion-body" id="body-${cat.id}">
        <div class="accordion-body-inner">
          ${cat.queries.map(q => `<button class="query-btn" onclick="openForm('${cat.id}','${q.type}')"><span class="q-icon">${q.icon}</span><span class="q-label">${q.name}</span><span class="q-arrow">‚Üí</span></button>`).join('')}
        </div>
      </div>
    </div>
  `).join('');
}

function toggleAccordion(id) {
  const item = document.querySelector(`[data-cat="${id}"]`);
  const body = document.getElementById('body-'+id);
  const open = item.classList.contains('open');
  document.querySelectorAll('.accordion-item').forEach(el => { el.classList.remove('open'); el.querySelector('.accordion-body').style.maxHeight='0'; });
  if (!open) { item.classList.add('open'); body.style.maxHeight = body.scrollHeight+'px'; setTimeout(()=>item.scrollIntoView({behavior:'smooth',block:'nearest'}),100); }
}

function openForm(catId, type) {
  const allCats = isAdmin ? [...categories, adminCategory] : [...categories];
  const cat = allCats.find(c=>c.id===catId);
  const q = cat.queries.find(x=>x.type===type);
  currentQuery = q;
  if (!q.fields.length) { executeQuery(q.type, {}); return; }
  const fc = document.getElementById('formCard');
  fc.innerHTML = `
    <div class="form-title">> ${q.name}</div>
    <div class="form-desc">root@n1tr:~# ${q.type} --execute</div>
    ${q.fields.map((f,i)=>`
      <div class="form-group">
        <label class="form-label">${f.label} ${f.optional?'<span class="form-optional">(opsiyonel)</span>':''}</label>
        <input class="form-input" id="field-${i}" type="text" placeholder="${f.placeholder}" ${f.maxlength?`maxlength="${f.maxlength}"`:''}autocomplete="off" spellcheck="false">
        ${f.optional?'<div class="form-hint">// Bo≈ü bƒ±rakabilirsiniz</div>':''}
      </div>
    `).join('')}
    <button class="form-submit" onclick="submitForm()">[ EXECUTE ]</button>
  `;
  showPage('form');
  document.getElementById('headerTitle').innerHTML=`> ${q.name}<span class="blink">_</span>`;
  setTimeout(()=>{const inp=document.getElementById('field-0');if(inp)inp.focus();},300);
}

function submitForm() {
  if (!currentQuery) return;
  const data = {};
  let valid = true;
  currentQuery.fields.forEach((f,i) => {
    const inp = document.getElementById('field-'+i);
    const v = inp.value.trim();
    if (!f.optional && !v) { inp.style.borderColor='var(--red)'; valid=false; } else { inp.style.borderColor=''; }
    data[f.key] = v || null;
  });
  if (!valid) { showToast('T√ºm alanlarƒ± doldurun','error'); return; }
  executeQuery(currentQuery.type, data);
}

// === API CALL ===
async function executeQuery(type, data) {
  showLoading(true);
  try {
    const resp = await fetch(API + '/api/query', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ type, data, userId })
    });
    const json = await resp.json();
    showLoading(false);

    if (json.requireChannel) {
      showChannelRequired(json.channelUrl);
    } else if (json.success && json.results) {
      showResults(currentQuery ? currentQuery.name : type, json.results);
    } else {
      showError(json.error || 'Bilinmeyen hata');
    }
  } catch (e) {
    showLoading(false);
    showError('Sunucuya baƒülanƒ±lamadƒ±');
    console.error(e);
  }
}

// === SHOW RESULTS ===
function showResults(title, results) {
  const c = document.getElementById('resultContainer');
  c.innerHTML = `
    <div class="result-header">
      <div class="result-title">> ${title}</div>
      <div class="result-count">${results.length} sonu√ß</div>
    </div>
    ${results.map((r, idx) => {
      const entries = Object.entries(r).filter(([k,v]) => v !== null && v !== undefined);
      const text = entries.map(([k,v]) => `${k}: ${v}`).join('\n');
      return `
        <div class="result-card">
          <div class="result-card-header">
            <div class="result-card-num">SONU√á #${idx+1}</div>
            <button class="result-copy-btn" onclick="copyResult(this,'${btoa(encodeURIComponent(text))}')">‚äï Kopyala</button>
          </div>
          <div class="result-rows">
            ${entries.map(([k,v]) => `
              <div class="result-row">
                <div class="result-row-label">${k}</div>
                <div class="result-row-value ${v?'':'empty'}">${v || '-'}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }).join('')}
    <button class="result-copy-all" onclick="copyAll()">üìã T√úM SONU√áLARI KOPYALA</button>
  `;
  window._lastResults = results;
  showPage('result');
  document.getElementById('headerTitle').innerHTML = `> Sonu√ßlar<span class="blink">_</span>`;
}

function showChannelRequired(channelUrl) {
  const c = document.getElementById('resultContainer');
  c.innerHTML = `
    <div class="error-box">
      <div class="error-icon">üîí</div>
      <div class="error-text">Kanal √úyeliƒüi Gerekli</div>
      <div class="error-hint">Botu kullanmak i√ßin @n1trkanal kanalƒ±na katƒ±lmalƒ±sƒ±nƒ±z</div>
      <button class="error-retry" style="border-color:var(--green);color:var(--green);margin-top:16px;" onclick="window.open('${channelUrl}','_blank')">üì¢ KANALA KATIL</button>
      <button class="error-retry" style="margin-top:8px;" onclick="goBack()">‚Üê Geri D√∂n</button>
    </div>
  `;
  showPage('result');
  document.getElementById('headerTitle').innerHTML = `> Kanal Gerekli<span class="blink">_</span>`;
}

function showError(msg) {
  const c = document.getElementById('resultContainer');
  c.innerHTML = `
    <div class="error-box">
      <div class="error-icon">‚ö†</div>
      <div class="error-text">${msg}</div>
      <div class="error-hint">L√ºtfen bilgileri kontrol edip tekrar deneyin</div>
      <button class="error-retry" onclick="goBack()">‚Üê Geri D√∂n</button>
    </div>
  `;
  showPage('result');
  document.getElementById('headerTitle').innerHTML = `> Hata<span class="blink">_</span>`;
}

function copyResult(btn, b64text) {
  const text = decodeURIComponent(atob(b64text));
  navigator.clipboard.writeText(text).then(() => {
    btn.classList.add('copied'); btn.textContent='‚úì OK';
    setTimeout(()=>{btn.classList.remove('copied');btn.textContent='‚äï Kopyala';},1500);
  }).catch(()=>showToast('Kopyalanamadƒ±','error'));
}

function copyAll() {
  if (!window._lastResults) return;
  const text = window._lastResults.map((r,i) => {
    return `--- SONU√á #${i+1} ---\n` + Object.entries(r).filter(([k,v])=>v).map(([k,v])=>`${k}: ${v}`).join('\n');
  }).join('\n\n');
  navigator.clipboard.writeText(text).then(()=>showToast('T√ºm sonu√ßlar kopyalandƒ±')).catch(()=>showToast('Kopyalanamadƒ±','error'));
}

// === Navigation ===
function showPage(page) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  if (page==='home') {
    document.getElementById('homePage').classList.add('active');
    document.getElementById('backBtn').classList.remove('visible');
    document.getElementById('headerTitle').innerHTML='N1 T√úRKƒ∞YE:~$ <span class="blink">_</span>';
    pageStack=['home'];
  } else if (page==='form') {
    document.getElementById('formPage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    pageStack.push('form');
  } else if (page==='result') {
    document.getElementById('resultPage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    pageStack.push('result');
  }
}

function goBack() {
  pageStack.pop();
  const prev = pageStack[pageStack.length-1] || 'home';
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  if (prev==='home') {
    document.getElementById('homePage').classList.add('active');
    document.getElementById('backBtn').classList.remove('visible');
    document.getElementById('headerTitle').innerHTML='N1 T√úRKƒ∞YE:~$ <span class="blink">_</span>';
  } else if (prev==='form') {
    document.getElementById('formPage').classList.add('active');
    document.getElementById('backBtn').classList.add('visible');
    document.getElementById('headerTitle').innerHTML=`> ${currentQuery?currentQuery.name:'Sorgu'}<span class="blink">_</span>`;
  }
}

function showLoading(s) { document.getElementById('loadingOverlay').classList.toggle('active',s); }
function showToast(msg, type) {
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.className='toast'+(type==='error'?' error':'')+' show';
  setTimeout(()=>t.className='toast',2500);
}

buildAccordion();
</script>
</body>
</html>
